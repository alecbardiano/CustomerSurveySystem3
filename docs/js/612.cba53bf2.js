"use strict";(self["webpackChunkcustomersurveysystem3"]=self["webpackChunkcustomersurveysystem3"]||[]).push([[612],{14186:(e,l,t)=>{t.r(l),t.d(l,{default:()=>xe});var a=t(83673),i=t(98880),o=t(62323);const r={class:"q-pa-lg"},n={class:"q-pa-md"},s={class:"row",style:{"padding-bottom":"20px"}},u={class:"row inline"},d={class:"row items-center justify-end"},c={class:"row items-center justify-end"},v={class:"q-pa-md"},m={key:1,class:"row"},f={class:"col-md-4"},p={class:"row inline"},g={class:"col-md-4 offset-md-4"},w={class:"row inline"},b={class:"q-pa-md"},h={class:"col-4 q-table__title"},y=(0,a.Uk)("Customer Satisfaction Measurement "),x={class:"col absolute-right"},S={key:0,class:"row"},D={key:0},C={key:1},_={class:"q-pa-md"},k={key:0},F={key:1},H=(0,a.Uk)("Minimize"),N=(0,a.Uk)("Maximize"),A=(0,a.Uk)("Close"),M=(0,a._)("div",{class:"text-h6"},"Enter Number of Customers Actual Served",-1),W=(0,a.Uk)(" Total Actual No. of Customers Served "),V=(0,a.Uk)(" Target No. of Respondents "),q=(0,a.Uk)(" Percentage "),R=(0,a._)("div",{class:"text-h6"},"File Error",-1),Y=(0,a.Uk)(" Please double check excel file uploaded ");function E(e,l,t,E,O,T){const U=(0,a.up)("q-toggle"),P=(0,a.up)("q-select"),z=(0,a.up)("q-btn"),Z=(0,a.up)("q-date"),I=(0,a.up)("q-popup-proxy"),Q=(0,a.up)("q-icon"),j=(0,a.up)("q-input"),B=(0,a.up)("q-form"),L=(0,a.up)("q-file"),$=(0,a.up)("q-space"),K=(0,a.up)("q-td"),G=(0,a.up)("q-tr"),J=(0,a.up)("q-table"),X=(0,a.up)("viewsurveyanswer"),ee=(0,a.up)("q-dialog"),le=(0,a.up)("q-tooltip"),te=(0,a.up)("q-bar"),ae=(0,a.up)("q-card-section"),ie=(0,a.up)("q-th"),oe=(0,a.up)("q-card-actions"),re=(0,a.up)("q-card"),ne=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",r,[(0,a._)("div",n,[(0,a.Wm)(U,{modelValue:e.showFilter,"onUpdate:modelValue":l[0]||(l[0]=l=>e.showFilter=l),label:"Show Filters"},null,8,["modelValue"])]),e.showFilter?((0,a.wg)(),(0,a.j4)(B,{key:0,ref:"dateform",onSubmit:l[8]||(l[8]=l=>e.dataUpdateWithDate())},{default:(0,a.w5)((()=>[(0,a._)("div",s,[(0,a.Wm)(P,{modelValue:e.division,"onUpdate:modelValue":[l[1]||(l[1]=l=>e.division=l),l[2]||(l[2]=l=>e.fillSectionList())],options:e.divisionsWithServ,label:"Division",style:{width:"200px"}},null,8,["modelValue","options"]),(0,a.Wm)(P,{modelValue:e.service,"onUpdate:modelValue":l[3]||(l[3]=l=>e.service=l),options:e.services,label:"Service",style:{width:"200px","margin-left":"40px"}},null,8,["modelValue","options"])]),(0,a._)("div",u,[(0,a.Wm)(j,{outlined:"",filled:"",mask:"date",modelValue:e.beforeDate,"onUpdate:modelValue":l[5]||(l[5]=l=>e.beforeDate=l),"lazy-rules":"",rules:[l=>l<=e.afterDate||"Field should be earlier than after date"],placeholder:"mm/dd/yy",hint:"Start Date"},{append:(0,a.w5)((()=>[(0,a.Wm)(Q,{name:"event",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(I,{ref:"qDateProxy","transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(Z,{modelValue:e.beforeDate,"onUpdate:modelValue":l[4]||(l[4]=l=>e.beforeDate=l)},{default:(0,a.w5)((()=>[(0,a._)("div",d,[(0,a.wy)((0,a.Wm)(z,{label:"Close",color:"primary",flat:""},null,512),[[ne]])])])),_:1},8,["modelValue"])])),_:1},512)])),_:1})])),_:1},8,["modelValue","rules"]),(0,a.Wm)(j,{outlined:"",filled:"",mask:"date",style:{"padding-left":"25px"},modelValue:e.afterDate,"onUpdate:modelValue":l[7]||(l[7]=l=>e.afterDate=l),"lazy-rules":"",rules:[l=>l>=e.beforeDate||"Field should be later than before date"],placeholder:"mm/dd/yy",hint:"End Date"},{append:(0,a.w5)((()=>[(0,a.Wm)(Q,{name:"event",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(I,{ref:"qDateProxy","transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(Z,{modelValue:e.afterDate,"onUpdate:modelValue":l[6]||(l[6]=l=>e.afterDate=l)},{default:(0,a.w5)((()=>[(0,a._)("div",c,[(0,a.wy)((0,a.Wm)(z,{label:"Close",color:"primary",flat:""},null,512),[[ne]])])])),_:1},8,["modelValue"])])),_:1},512)])),_:1})])),_:1},8,["modelValue","rules"]),(0,a.Wm)(z,{type:"submit",label:"Go",color:"primary",style:{"margin-left":"25px",width:"70px",height:"25px"}})])])),_:1},512)):(0,a.kq)("",!0),(0,a.wy)((0,a._)("div",v,[(0,a.Wm)(U,{modelValue:e.showFunctions,"onUpdate:modelValue":l[9]||(l[9]=l=>e.showFunctions=l),label:"Show Functions"},null,8,["modelValue"])],512),[[i.F8,"PMD"==e.userLoggedin.role.name||"Management"==e.userLoggedin.role.name]]),e.showFunctions?((0,a.wg)(),(0,a.iD)("div",m,[(0,a._)("div",f,[(0,a._)("div",p,[(0,a.Wm)(L,{modelValue:e.importFile,"onUpdate:modelValue":l[10]||(l[10]=l=>e.importFile=l),ref:"uploadRefButton",label:"Import Data ",accept:".csv,.xls,.xlsx",color:"primary"},{prepend:(0,a.w5)((()=>[(0,a.Wm)(Q,{name:"attach_file"})])),_:1},8,["modelValue"]),(0,a.Wm)(z,{type:"submit",label:"Import Data",class:"q-mt-md",color:"primary",onClick:l[11]||(l[11]=l=>e.fileUpload(e.importFile)),style:{"margin-left":"25px"}})])]),(0,a._)("div",g,[(0,a._)("div",w,[(0,a.Wm)(z,{type:"submit",label:"Generate Raw Data",class:"q-mt-md",color:"primary",onClick:l[12]||(l[12]=l=>e.generateExcel())}),(0,a.Wm)(z,{type:"submit",label:"Generate PDF Report",class:"q-mt-md",color:"primary",onClick:l[13]||(l[13]=l=>e.numberOfCustomerDialog=!0),style:{"margin-left":"15px"}})])])])):(0,a.kq)("",!0)]),(0,a._)("div",b,[e.rows?((0,a.wg)(),(0,a.j4)(J,{key:0,class:"overallAverage",rows:e.rows,columns:e.cols,"row-key":"name",onRowClick:e.onRowClick,loading:e.loading,filter:e.filter,pagination:e.pagination,"onUpdate:pagination":l[17]||(l[17]=l=>e.pagination=l),"visible-columns":e.visibleColumns,onRequest:e.onRequest,"binary-state-sort":"",separator:"cell"},{top:(0,a.w5)((t=>[(0,a._)("div",h,[y,(0,a.Wm)(j,{class:"placeholderClass",borderless:"",dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":l[14]||(l[14]=l=>e.filter=l),placeholder:"Search"},{append:(0,a.w5)((()=>[(0,a.Wm)(Q,{class:"searchClass",name:"search"})])),_:1},8,["modelValue"])]),(0,a._)("div",x,[(0,a.Wm)(z,{flat:"",round:"",dense:"",icon:t.inFullscreen?"fullscreen_exit":"fullscreen",onClick:t.toggleFullscreen,class:"q-ml-md"},null,8,["icon","onClick"])]),(0,a.Wm)($),e.$q.screen.gt.xs?((0,a.wg)(),(0,a.iD)("div",S,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.toggles,(t=>((0,a.wg)(),(0,a.iD)("div",{key:t.val},[(0,a.Wm)(U,{modelValue:e.visibleColumns,"onUpdate:modelValue":l[15]||(l[15]=l=>e.visibleColumns=l),val:t.val,color:"yellow",label:t.label},null,8,["modelValue","val","label"])])))),128))])):((0,a.wg)(),(0,a.j4)(P,{key:1,modelValue:e.visibleColumns,"onUpdate:modelValue":l[16]||(l[16]=l=>e.visibleColumns=l),multiple:"",borderless:"",dense:"","options-dense":"","display-value":e.$q.lang.table.columns,"emit-value":"","map-options":"",options:e.cols,"option-value":"name",style:{"min-width":"150px"}},null,8,["modelValue","display-value","options"]))])),"bottom-row":(0,a.w5)((()=>[(0,a.Wm)(G,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.visibleColumnsAverage,(e=>((0,a.wg)(),(0,a.j4)(K,{key:e.id},{default:(0,a.w5)((()=>[e.tsrNo?((0,a.wg)(),(0,a.iD)("p",D,"Average: ")):0!=e.value&&!isNaN(e.value)&&e.visible?((0,a.wg)(),(0,a.iD)("p",C,(0,o.zw)(e.value),1)):(0,a.kq)("",!0)])),_:2},1024)))),128))])),_:1})])),_:1},8,["rows","columns","onRowClick","loading","filter","pagination","visible-columns","onRequest"])):(0,a.kq)("",!0)]),(0,a._)("div",_,[(0,a.Wm)(J,{title:e.titleOverall,rows:e.rowsOverall,columns:e.colsOverall,loading:e.overallLoading,"row-key":"name",separator:"cell",class:"overallAverage","binary-state-sort":"",style:{height:"500px"},"rows-per-page-options":[0]},{"bottom-row":(0,a.w5)((()=>[(0,a.Wm)(G,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.overAllAverage,(e=>((0,a.wg)(),(0,a.j4)(K,{key:e.key},{default:(0,a.w5)((()=>[e.dimension?((0,a.wg)(),(0,a.iD)("p",k,"Average: ")):((0,a.wg)(),(0,a.iD)("p",F,(0,o.zw)(e.value),1))])),_:2},1024)))),128))])),_:1})])),_:1},8,["title","rows","columns","loading"])]),(0,a.Wm)(ee,{modelValue:e.prompt,"onUpdate:modelValue":l[19]||(l[19]=l=>e.prompt=l)},{default:(0,a.w5)((()=>[(0,a.Wm)(X,{modelValue:e.tsrData,"onUpdate:modelValue":l[18]||(l[18]=l=>e.tsrData=l),cols:e.cols},null,8,["modelValue","cols"])])),_:1},8,["modelValue"]),(0,a.Wm)(B,{onSubmit:e.generatePDFValidation,class:"q-gutter-md",ref:"addInputNumberofCustomersForm"},{default:(0,a.w5)((()=>[(0,a.Wm)(ee,{maximized:e.maximizedToggle,modelValue:e.numberOfCustomerDialog,"onUpdate:modelValue":l[23]||(l[23]=l=>e.numberOfCustomerDialog=l),persistent:""},{default:(0,a.w5)((()=>[(0,a.Wm)(re,{class:"bg-primary text-white"},{default:(0,a.w5)((()=>[(0,a.Wm)(te,null,{default:(0,a.w5)((()=>[(0,a.Wm)($),(0,a.Wm)(z,{dense:"",flat:"",icon:"minimize",onClick:l[20]||(l[20]=l=>e.maximizedToggle=!1),disable:!e.maximizedToggle},{default:(0,a.w5)((()=>[e.maximizedToggle?((0,a.wg)(),(0,a.j4)(le,{key:0,class:"bg-white text-primary"},{default:(0,a.w5)((()=>[H])),_:1})):(0,a.kq)("",!0)])),_:1},8,["disable"]),(0,a.Wm)(z,{dense:"",flat:"",icon:"crop_square",onClick:l[21]||(l[21]=l=>e.maximizedToggle=!0),disable:e.maximizedToggle},{default:(0,a.w5)((()=>[e.maximizedToggle?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(le,{key:0,class:"bg-white text-primary"},{default:(0,a.w5)((()=>[N])),_:1}))])),_:1},8,["disable"]),(0,a.wy)((0,a.Wm)(z,{dense:"",flat:"",icon:"close"},{default:(0,a.w5)((()=>[(0,a.Wm)(le,{class:"bg-white text-primary"},{default:(0,a.w5)((()=>[A])),_:1})])),_:1},512),[[ne]])])),_:1}),(0,a.Wm)(ae,null,{default:(0,a.w5)((()=>[M])),_:1}),(0,a.Wm)(ae,null,{default:(0,a.w5)((()=>[(0,a.Wm)(J,{rows:e.rowsnumberOfCustomers,columns:e.colsnumberOfCustomers,"row-key":"col1",separator:"cell","rows-per-page-options":[0]},{header:(0,a.w5)((()=>[(0,a.Wm)(G,null,{default:(0,a.w5)((()=>[(0,a.Wm)(ie,{key:"Month",style:{width:"250px"},class:"primary"}),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.divisions,(e=>((0,a.wg)(),(0,a.j4)(ie,{key:e.name,colspan:e.count},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.division),1)])),_:2},1032,["colspan"])))),128))])),_:1}),(0,a.Wm)(G,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.colsnumberOfCustomers,(e=>((0,a.wg)(),(0,a.j4)(ie,{key:e.name,class:"bg-light-9 black-white"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.name),1)])),_:2},1024)))),128))])),_:1})])),"bottom-row":(0,a.w5)((()=>[(0,a.Wm)(G,null,{default:(0,a.w5)((()=>[(0,a.Wm)(K,null,{default:(0,a.w5)((()=>[W])),_:1}),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.divisioAndSectionList.length,((l,t)=>((0,a.wg)(),(0,a.j4)(K,{style:{"text-align":"center"},key:l.key},{default:(0,a.w5)((()=>[(0,a.Wm)(j,{filled:"",modelValue:e.totalActualArray[t],"onUpdate:modelValue":l=>e.totalActualArray[t]=l,label:"Actual Number of Customers Served",rules:[e=>!!e||"Field is required"]},null,8,["modelValue","onUpdate:modelValue","rules"])])),_:2},1024)))),128))])),_:1}),(0,a.Wm)(G,null,{default:(0,a.w5)((()=>[(0,a.Wm)(K,null,{default:(0,a.w5)((()=>[V])),_:1}),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.divisioAndSectionList.length,((l,t)=>((0,a.wg)(),(0,a.j4)(K,{style:{"text-align":"center"},key:l.key},{default:(0,a.w5)((()=>[(0,a.Wm)(j,{filled:"",modelValue:e.targetNoRespondents[t],"onUpdate:modelValue":l=>e.targetNoRespondents[t]=l,label:"Target Number",rules:[e=>!!e||"Field is required"]},null,8,["modelValue","onUpdate:modelValue","rules"])])),_:2},1024)))),128))])),_:1}),(0,a.Wm)(G,null,{default:(0,a.w5)((()=>[(0,a.Wm)(K,null,{default:(0,a.w5)((()=>[q])),_:1})])),_:1})])),_:1},8,["rows","columns"])])),_:1}),(0,a.Wm)(oe,{align:"right"},{default:(0,a.w5)((()=>[(0,a.Wm)(z,{flat:"",label:"Generate PDF Report",class:"bg-white text-black","icon-right":"notes",onClick:l[22]||(l[22]=l=>e.generatePDFValidation()),color:"black"})])),_:1})])),_:1})])),_:1},8,["maximized","modelValue"])])),_:1},8,["onSubmit"]),(0,a.Wm)(ee,{modelValue:e.uploadDialog,"onUpdate:modelValue":l[24]||(l[24]=l=>e.uploadDialog=l)},{default:(0,a.w5)((()=>[(0,a.Wm)(re,null,{default:(0,a.w5)((()=>[(0,a.Wm)(ae,{class:"bg-primary text-white"},{default:(0,a.w5)((()=>[R])),_:1}),(0,a.Wm)(ae,null,{default:(0,a.w5)((()=>[Y])),_:1}),(0,a.Wm)(oe,{align:"right"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(z,{flat:"",label:"OK",color:"primary"},null,512),[[ne]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}t(10071);var O=t(61959),T=t(26873),U=t(93422),P=(t(12841),t(48825)),z=t(5474),Z=t(11488),I=t.n(Z),Q=t(24334),j=t.n(Q),B=t(93617),L=t(55093);const $=(0,a.aZ)({name:"Admin",components:{viewsurveyanswer:L.Z},setup(){let e;const l=(0,B.oR)(),t=(0,O.iH)([]),i=(0,O.iH)([]),o=(0,O.iH)(["tsrNo","division","service","industry","Overall Rating","publishedDate"]),r=(0,O.iH)([]),n=(0,O.iH)([]),s=(0,P.Z)(),u=(0,O.iH)(null),d=(0,O.iH)([]),c=(0,O.iH)([]),v=(0,O.iH)([]),m=(0,O.iH)([]),f=((0,O.iH)(0),(0,O.iH)("")),p=(0,O.iH)(""),g=(0,O.iH)(null),w=(0,O.iH)([]),b=(0,O.iH)([]),h=(0,O.iH)(!1),y=(0,O.iH)(!1),x=(0,O.iH)(!1);let S=Date.now();S=I()().year();const D=(0,O.iH)("position"),C=(0,O.Fl)((()=>j()(_.value,D.value))),_=(0,O.iH)([]),k=(0,O.iH)([]),F=(0,O.iH)(!0),H=(0,O.iH)([]),N=(0,O.iH)([]),A=(0,O.iH)(""),M=(0,O.iH)(!0),W=(0,O.iH)({sortBy:"desc",descending:!1,page:1,rowsPerPage:10,rowsNumber:5}),V=(0,O.iH)([]),q=(0,O.iH)(null),R=(0,O.iH)([]),Y=(0,O.iH)([]),E=(0,O.iH)(null);(0,a.YP)(p,((e,l)=>{let t=e.toString();return we(t)})),(0,a.YP)(f,((e,l)=>{let t=e.toString();return we(t)}));const Z=(0,O.iH)(null),Q=(0,O.qj)({}),$=(0,O.iH)([]),K=(0,O.iH)([]),G=((0,O.iH)([]),(0,O.iH)(null)),J=(0,O.iH)([]),X=(0,O.iH)([]),ee=(0,O.iH)(!0),le=(0,O.iH)("Overall Agency Citizen/ Client Satisfaction Score YTD "+(new Date).getFullYear()),te=(0,O.iH)([]),ae=(0,O.iH)([]),ie=(0,O.iH)([]),oe=(0,O.iH)([]),re=(0,O.iH)([]),ne=(0,O.iH)([]),se=(0,O.iH)(!1),ue=(0,O.iH)(!1),de=(0,O.Fl)((()=>l.getters["auth/getUserProfile"]));function ce(){Y.value=r.value.filter((e=>e.division==q.value)).map((e=>e.service))}async function ve(e,l,t,a,i,o,r,n){try{return i&&o?n?await(0,T.MF)(e,l,t,a,i,o,r,n):await(0,T.MF)(e,l,t,a,i,o,r,""):n?await(0,T.MF)(e,l,t,a,"","",r,n):await(0,T.MF)(e,l,t,a,"","",r,"")}catch(s){throw s}}function me(e){let l=[];return e.map((function(e){let t={tsrNo:e.tsrNo,submittedAt:ge(e.submittedAt),division:e.division,industry:e.industry,service:e.service,section:e.section},a=e.answers.map((e=>e.question));a=a.filter((function(e){return null!=e}));for(let l=0;l<a.length;l++)""!=e.answers[l].question&&(t[e.answers[l].question]=e.answers[l].value);l.push(t)})),l}function fe(){let e=[];if(0==N.value.length){N.value.push({name:"tsrNo",align:"left",label:"TSR Number",field:"tsrNo",sortable:!0}),N.value.push({name:"division",align:"left",label:"Division",field:"division"}),N.value.push({name:"service",align:"left ",label:"Service",field:"service"}),N.value.push({name:"industry",align:"left",label:"Industry",field:"industry"});for(let e=0;e<C.value.length;e++)if(5!=C.value[e].question_type){let l={name:"",align:"left",label:"",field:""};l.name=C.value[e].description,l.label=C.value[e].description,l.field=C.value[e].id;let t={val:C.value[e].description,label:l.label};V.value.push(t),N.value.push(l)}N.value.push({name:"publishedDate",align:"left",label:"Submitted Date",field:"submittedAt"})}return k.value.map((function(l){let t={tsrNo:l.tsrNo,submittedAt:be(l.submittedAt),division:l.division,industry:l.industry,service:l.service,section:l.section},a=l.answers.map((e=>e.question));for(let e=0;e<a.length;e++)""!=l.answers[e].question&&(t[l.answers[e].question]=l.answers[e].value);e.push(t)})),e}async function pe(e){ee.value=!0,J.value.length>0&&(J.value=[]),f.value&&p.value&&(le.value="Overall Agency Citizen/ Client Satisfaction Score-"+I()(f.value).format("MMMM-YYYY")+" to "+I()(p.value).format("MMMM-YYYY")),J.value.push({name:"Dimension",align:"left",label:"Dimension",field:"dimension",style:"width: 300px"});let l=[];J.value.push({name:"Score",align:"left",label:"Score All in Service",field:"scoreservice",style:"width: 300px"}),l=await(0,T.TB)(f.value,p.value);for(let a=0;a<e.length;a++)J.value.push({name:e[a].division,align:"left",label:e[a].division,field:e[a].division,sortable:!0});for(let a=0;a<X.value.length;a++){let e=l.filter((e=>e.description===X.value[a].dimension));for(let l=0;l<e.length;l++)X.value[a][[e[l].division]]=parseFloat(e[l].avgVal.toFixed(2))}for(let a=0;a<X.value.length;a++){const{dimension:e,id:l,scoreservice:i,...o}=X.value[a];let r=0,n=0;for(var t in o)0!=o[t]&&(isNaN(o[t])?r+=0:r+=o[t],n++);let s=parseFloat((Math.round(r/n*100)/100).toFixed(2));isNaN(s)&&(s=0),X.value[a]["scoreservice"]=s}G.value=await Re(J.value,X.value)}function ge(e){return I()(e).format("YYYY/MM/DD")}function we(e){return I()(e).format("YYYY-MM-DD")}function be(e){return I()(e).format("MMMM")}async function he(l){if(u.value){ye();let t=l.name.split("-");if(t){let a=t[t.length-1].split(".");if(a){let t=await We(l);const i=z.xlsx.utils.sheet_to_json(z.xlsx.read(t,{type:"binary",cellDates:!0}).Sheets["Details of CSF forms"]);let o=await Ve(i,a[0]);0==o?s.notify({message:"Responses Migrated",color:"positive",icon:"success"}):1==o?s.notify({message:"Responses Not Migrated, Error found: ",color:"negative",icon:"failed"}):2==o&&s.notify({color:"red-5",textColor:"white",icon:"warning",message:"Duplicate TSR found in file"}),e=void 0,s.loading.hide()}}}else s.notify({color:"red-5",textColor:"white",icon:"warning",message:"File field Empty"})}function ye(){s.loading.show({message:"Please wait for data to be imported..",boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"})}function xe(){s.loading.show({message:"Please wait for data to be loaded",boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"})}function Se(){e=void 0,s.loading.hide()}function De(e,l,t,a){var i=[];if(2==t){let t=l.map((e=>e)),a=l.map((e=>e.label));i.push(a);let o=e.map((e=>e));o.forEach((function(e){var l=[];t.forEach((function(t){e[t.field]?[t.label]&&l.push(e[t.field]):l.push("")})),i.push(l)}))}else if(3==t){let t=l.map((e=>e)),a=[];a.push({}),a.push({}),n.value.forEach((e=>{a.push({text:e.division,colSpan:e.count});for(let l=0;l<e.count-1;l++)a.push({})})),i.push(a);let o=l.map((e=>e.label));i.push(o);let r=e.map((e=>e));r.forEach((function(e){var l=[];t.forEach((function(t){e[t.field]?[t.label]&&l.push(e[t.field]):l.push({text:""})})),i.push(l)}))}else if(4==t){console.log("Data",e);let t=l.map((e=>e)),a=[];a.push({}),n.value.forEach((e=>{a.push({text:e.division,colSpan:e.count});for(let l=0;l<e.count-1;l++)a.push({})})),a.push({}),i.push(a);let o=l.map((e=>e.label));i.push(o);let r=e.map((e=>e));r.forEach((function(e){var l=[];t.forEach((function(t){e[t.field]?[t.label]&&l.push(e[t.field]):l.push({text:"0"})})),i.push(l)}))}else if(5==t){let t=l.map((e=>e)),a=l.map((e=>e.label));i.push(a);let o=e.map((e=>e)),r=0,n=0,s=0,u=0,d=0,c=0,v=0,m=0,f=0,p=0,g=0,w=0;o.forEach((function(e){r%12==0&&(i.push(["Division: ",e.division,"","","","","","","",""]),i.push(["Service: ",e.service,"","","","","","","",""]),r+=2);var l=[];t.forEach((function(t){if(e[t.field]){if(12==t.field&&e[t.field])if(5==e.id||4==e.id){let l=parseFloat(e[t.field]);v+=l,l=l/100*e.countsDivision,p+=l}else if(3==e.id){let l=parseFloat(e[t.field]);m+=l,l=l/100*e.countsDivision,g+=l}else if(e.id<=2){let l=parseFloat(e[t.field]);f+=l,l=l/100*e.countsDivision,w+=l}[t.label]&&l.push(e[t.field])}else l.push("")})),i.push(l),r+=1,(r+4)%12!=0&&8!=r||(n=e.countsDivision,i.push(["No of Respondents: ",n,"","","","","","","",""]),i.push(["No. and % of customers who rated the service as very satisfactory or better: ",Math.round(p),v.toFixed(2).toString()+"%","","","","","","",""]),i.push(["No. and % of customers who rated the service as satisfactory or better: ",Math.round(g),m.toFixed(2).toString()+"%","","","","","","",""]),i.push(["No. and % of customers who rated the service as Fair or Poor: ",Math.round(w),f.toFixed(2).toString()+"%","","","","","","",""]),r+=4,s+=n,u+=p,d+=g,c+=w,v=0,m=0,f=0,g=0,p=0,w=0)})),i.push(["Total Summary of Citizen/Client Satisfaction Survey CCSS Rating ","","","","","","","","",""]),i.push(["No. and % of customers who rated the Center's service as very satisfactory or better",Math.round(u),(u/s*100).toFixed(2).toString()+"%","","","","","","",""]),i.push(["No. and % of customers who rated the Center's service as satisfactory or better",Math.round(d),(d/s*100).toFixed(2).toString()+"%","","","","","","",""]),i.push(["No. and % of customers who rated the service as Fair or Poor",Math.round(c),(c/s*100).toFixed(2).toString()+"%","","","","","","",""]),i.push(["Total No. of Respondents : ",s,"","","","","","","",""])}else if(6==t){let t=l.map((e=>e)),a=l.map((e=>e.label));i.push(a);let o=e.map((e=>e)),r="",n="",s=0;o.forEach((function(e){e.service&&e.division&&(r!=e.division||0==s?(i.push([{text:"Division: ",border:[!0,!0,!1,!1]},{text:e.division,colSpan:3,border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!0,!1]}]),i.push([{text:"Service: ",border:[!0,!0,!1,!1]},{text:e.service,colSpan:3,border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!0,!1]}]),s+=2):n!=e.service&&i.push([{text:"Service: ",border:[!0,!0,!1,!1]},{text:e.service,colSpan:3,border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!1,!1]},{text:"",border:[!1,!0,!0,!1]}])),r=e.division,n=e.service,s++;var l=[];t.forEach((function(t){e[t.field]?[t.label]&&l.push({text:e[t.field]}):l.push("")})),i.push(l)}))}return i}function Ce(e){ae.value=(0,U.WH)(r.value),te.value=(0,U.DU)(r.value,e),oe.value=(0,U.v)(r.value),ie.value=(0,U.tY)(r.value,e,t.value,i.value),ne.value=(0,U._T)(C.value),re.value=(0,U.x7)(C.value,r.value,e)}function _e(e,l){return e.division<l.division?-1:e.division>l.division?1:0}function ke(e,l){return e.service<l.service?-1:e.service>l.service?1:0}async function Fe(){let e=[];if(f.value&&p.value)e=await He(f.value,p.value);else{let l=(new Date).getFullYear(),t=new Date(l,0,1),a=new Date;e=await He(t,a)}if(Ce(e),0==e.length)s.notify({message:"No data found, PDF Creation Failed",color:"negative",position:"top"});else{e=e.sort(_e),e=e.sort(ke);let a=me(e),i=J.value.map((({field:e,label:l})=>({field:e,label:l}))),o=N.value.map((({field:e,label:l})=>({field:e,label:l}))),n=ae.value.map((({field:e,label:l})=>({field:e,label:l}))),s=o.filter((function(e){return 4!=e.field})),u=f.value?be(f.value):"January",d=p.value?be(p.value):be(Date.now());var l={pageSize:"LEGAL",pageOrientation:"landscape",pageMargins:[40,60,40,40],header:{stack:[{text:"METALS INDUSTRY RESEARCH AND DEVELOPMENT CENTER",style:"header",fontSize:11},{text:"CUSTOMER SURVEY MANAGEMENT REPORT",style:"header",fontSize:13},{text:"TECHNICAL AND SCIENTIFIC EQUIPMENT",style:"header",fontSize:13},{text:"As of 31 December 2020",style:"header",fontSize:11},{text:"FOR WHICH ROBERT O DIZON, EXECUTIVE DIRECTOR, IS ACCOUNTABLE, HAVING ASSUMED SUCH ACCOUNTABILITY ON JANUARY 2016",style:"header",bold:!1,fontSize:11}],margin:[34,28.91,34,21.54]},footer:function(e,l){return{table:{widths:[100],body:[[{text:"Page "+e+" of "+l,alignment:"center"}]]},layout:"noBorders"}},content:[{text:"Overall Agency Citizen/ Client Satisfaction Score",style:"tableHeader"},{text:u+" - "+d,style:"tableHeader"},{table:{headerRows:1,body:De(X.value,i,2,r.value)},style:"tableOverallAgency"},{text:"Customer Satisfaction Measurement",style:"tableHeader",pageBreak:"before",pageOrientation:"landscape"},{table:{headerRows:1,body:De(a,s,6,r.value)},style:"table"},{text:"Overall Performance of the Center Based on CSS Responses",style:"tableHeader",pageBreak:"before",pageOrientation:"landscape"},{table:{headerRows:2,body:De(te.value,n,3,r.value)},style:"table"},{text:"Number of Customers and CSM Respondents Per Service Area",style:"tableHeader",pageBreak:"before",pageOrientation:"landscape"},{table:{headerRows:2,body:De(ie.value,oe.value,4,r.value)},style:"table"},{text:"Summary of Citizen/Client Satisfaction Survey CCSS Rating",style:"tableHeader",pageBreak:"before",pageOrientation:"landscape"},{table:{headerRows:1,body:De(re.value,ne.value,5,r.value)},style:"table"}],pageBreakBefore:function(e,l,t,a){return 1===e.headlineLevel&&0===l.length},styles:{header:{fontSize:14,bold:!0,alignment:"center"},tableHeader:{bold:!0,fontSize:16,alignment:"center"},table:{fontSize:10,alignment:"center"},tableOverallAgency:{fontSize:16,alignment:"center"}}},t=z.pdfMake.createPdf(l);t.open()}}async function He(e,l){let t,a=[],i=I()(e).month(),o=I()(e).year(),r=Math.floor(I()(l).diff(I()(e),"months",!0));for(let n=0;n<=r;n++)t=await(0,T.jH)(i,o),t.forEach((e=>{a.push(e)})),11==i?(i=0,o+=1):i+=1;return a}async function Ne(){let e,l=[];if(f.value&&p.value)l=await He(f.value,p.value),e=I()(f.value).format("MMMM-YYYY")+" - "+I()(p.value).format("MMMM-YYYY");else{let t=(new Date).getFullYear(),a=new Date(t,0,1),i=new Date;l=await He(a,i),e="January "+t+" - "+I()(Date.now()).format("MMMM-YYYY")}if(0==l.length)s.notify({message:"No data found,  Excel Creation Failed",color:"negative",position:"top"});else{Ce(l),l=l.sort(_e),l=l.sort(ke);let s=me(l),d=J.value.map((({field:e,label:l})=>({field:e,label:l}))),c=N.value.map((({field:e,label:l})=>({field:e,label:l}))),v=ae.value.map((({field:e,label:l})=>({field:e,label:l}))),m=c.filter((function(e){return 4!=e.field}));var t=z.xlsx.utils.json_to_sheet(De(X.value,d,2,r.value));let f=De(s,m,6,r.value),p=f.map((function(e){return Array.isArray(e)?e[0]&&!e[0].hasOwnProperty("text")?e:e.map((e=>e.text)):e}));var a=z.xlsx.utils.json_to_sheet(p);let g=De(te.value,v,3,r.value),w=g.map((function(e){if(Array.isArray(e))for(let l=0;l<e.length;l++)if(e[l]&&e[l].hasOwnProperty("colSpan")){let t=parseInt(e[l]["colSpan"]),a=e[l]["text"];for(let i=0;i<t;i++)e[l+i]=a}return e}));var i=z.xlsx.utils.json_to_sheet(w);let b=De(ie.value,oe.value,4,r.value),h=b.map((function(e){if(Array.isArray(e))for(let l=0;l<e.length;l++)if(e[l]&&e[l].hasOwnProperty("colSpan")){let t=parseInt(e[l]["colSpan"]),a=e[l]["text"];for(let i=0;i<t;i++)e[l+i]=a}return e}));var o=z.xlsx.utils.json_to_sheet(h),n=z.xlsx.utils.json_to_sheet(De(re.value,ne.value,5,r.value)),u=z.xlsx.utils.book_new();z.xlsx.utils.book_append_sheet(u,t,"Overall Agency Citizen Score"),z.xlsx.utils.book_append_sheet(u,a,"Customer Satisfaction Measure"),z.xlsx.utils.book_append_sheet(u,i,"Overall Performance CSS"),z.xlsx.utils.book_append_sheet(u,o,"Number of Customers Per Service"),z.xlsx.utils.book_append_sheet(u,n,"Summary of Citizen CCSS Rating"),z.xlsx.writeFile(u,e.toString()+" CSMS Raw Data .xlsx")}}async function Ae(){xe(),W.value.page=1;let e=await g.value.validate();e&&(await Ee({pagination:W.value,filter:void 0}),await pe(n.value)),Se()}function Me(e,l){h.value=!0,Q.value=l}async function We(e){var l=new FileReader;return new Promise(((t,a)=>{l.onerror=()=>{l.abort(),a(new DOMException("Problem parsing input file."))},l.onload=()=>{t(l.result)},l.readAsArrayBuffer(e)}))}async function Ve(e,l){let t=[];e.forEach((e=>{let a=e.Month.toString()+" "+l.toString(),i=new Date(a);const o={division:e.Division,service:e.Service,industry:e.Sector,tsrNo:e.TSRNo,submittedAt:i};let r=[];for(var n in e)if(e.hasOwnProperty(n)){n=n.split(",");let l=e.TSRNo;if(n[1]){const t={answerid:"",value:e[n].toString(),question:n[1].toString(),tsrNo:l};r.push(t)}}o["answers"]=r,t.push(o)}));const a=new Set(t.map((e=>e.tsrNo))),i=t.map((e=>e.tsrNo)),o=Array.from(a);o.filter((e=>!i.includes(e))).concat(i.filter((e=>!o.includes(e))));if(a.size<t.length)return 2;for(const r of t){let e=[];if("ATD"===r.division){let e="MIRDC-",l=I()(r.submittedAt).format("MMYYYY"),t=r.tsrNo;r.tsrNo=e+l.toString()+"-"+t}else{let e=I()(r.submittedAt).format("YY"),l=r.tsrNo;r.tsrNo=e.toString()+"-"+l}let l=await(0,T.ZS)(e,r.answers,r.tsrNo,r.industry,r.service,r.division,r.submittedAt,"");if("200"!=l)return 1}return await Ee({pagination:W.value,filter:void 0}),0}async function qe(e,l,t,a,i){let o;if(o=q.value||E.value?4:1,f.value&&p.value?k.value=t?await ve(e,l,q.value,E.value,f.value,p.value,o,t):await ve(e,l,q.value,E.value,f.value,p.value,o,""):k.value=t?await ve(e,l,q.value,E.value,S+"-01-01",S+"-12-31",o,t):await ve(e,l,q.value,E.value,S+"-01-01",S+"-12-31",o,""),d.value=fe(),a){const e="desc"===a?i?(e,l)=>e.name>l.name?-1:e.name<l.name?1:0:(e,l)=>e.name>l.name?1:e.name<l.name?-1:0:i?(e,l)=>parseFloat(l[a])-parseFloat(e[a]):(e,l)=>parseFloat(e[a])-parseFloat(l[a]);d.value.sort(e)}return d.value}function Re(e,l){let t=e.map((e=>({field:e.field,label:e.name}))),a=[];for(let o=0;o<t.length;o++){let e={};e[t[o].field]=[],e["id"]=t[o].label;let r=l.map((function(e){return e[t[o].field]}));var i=r.filter((function(e){if(void 0!=e||""==e||!isNaN(e))return e}));let n=0;for(let l=0;l<i.length;l++)isNaN(i[l])||(n+=parseFloat(i[l]));let s=parseFloat((Math.round(n/i.length*100)/100).toFixed(2));isNaN(s)?e["value"]=0:e["value"]=s,e["visible"]=!1,a.push(e)}return a}function Ye(){Z.value.validate().then((e=>{e?Fe():s.notify({color:"red-5",textColor:"white",icon:"warning",message:"Fill up all the necessary fields"})}))}async function Ee(e){const{page:l,rowsPerPage:t,sortBy:a,descending:i}=e.pagination,o=e.filter;if(M.value=!0,ee.value=!0,f.value&&p.value)f.value=ge(f.value),p.value=ge(p.value),q.value||E.value?T.d$.value=await(0,T.sD)(q.value,E.value,f.value,p.value,o):T.d$.value=await(0,T.d$)(f.value,p.value,o);else{let e=(new Date).getFullYear();q.value||E.value?T.d$.value=await(0,T.kJ)(q.value,E.value,e,o):T.d$.value=await(0,T.bO)(e,o)}if(0==X.value.length)for(let u=0;u<C.value.length;u++){let e={dimension:C.value[u].description,id:C.value[u].id};2==C.value[u].question_type&&X.value.push(e)}M.value=!0,W.value.rowsNumber=T.d$.value;const r=(l-1)*t,n=0===t?T.d$.value:t,s=await qe(r,n,o,a,i);K.value=[...new Set(k.value.map((e=>e.division)))].filter((function(e){return null!==e})),H.value.splice(0,H.value.length,...s),$.value=Re(N.value,H.value),W.value.page=l,W.value.rowsPerPage=t,W.value.sortBy=a,W.value.descending=i,M.value=!1,ee.value=!1}return(0,a.Jd)((()=>{void 0!==e&&(clearTimeout(e),s.loading.hide())})),(0,a.bv)((async()=>{console.log("mounted"),xe();try{_.value=await(0,T.ld)()}catch(e){console.log("error",error)}b.value.push({name:"",align:"left",label:"",field:"month",sortable:!0}),r.value=await(0,T.nh)(),r.value.forEach((e=>{let l=e.keyname,t={name:e.service,align:"center",label:e.service,field:l,sortable:!0};b.value.push(t)})),R.value=[...new Set(r.value.map((e=>e.division)))],n.value=await(0,T.P_)();await(0,T.ld)();console.log("A",b.value),await Ee({pagination:W.value,filter:void 0}),await pe(n.value),Se()})),{rowsnumberOfCustomers:w,colsnumberOfCustomers:b,rowsTable:d,rowsFilter:c,answers:m,listOfTsr:v,cols:N,generateExcel:Ne,generatePDF:Fe,beforeDate:f,afterDate:p,prompt:h,uploadDialog:y,onRowClick:Me,viewsurveyanswer:L.Z,tsrData:Q,dateform:g,dateTime:ge,filter:A,onRequest:Ee,pagination:W,rows:H,loading:M,finalAverageDataRow:$,rowsOverall:X,colsOverall:J,overallLoading:ee,overAllAverage:G,titleOverall:le,importFile:u,fileUpload:he,showLoading:ye,dataUpdateWithDate:Ae,division:q,service:E,services:Y,divisions:n,fillSectionList:ce,divisionsWithServ:R,showFilter:se,showFunctions:ue,visibleColumns:o,visibleColumnsAverage:(0,O.Fl)((()=>($.value.forEach((e=>{let l=Object.values(o.value);l.includes(e.id)?e.visible=!0:e.visible=!1})),$.value.filter((e=>e.visible))))),toggles:V,userLoggedin:de,numberOfCustomerDialog:x,divisioAndSectionList:r,targetNoRespondents:t,totalActualArray:i,generatePDFValidation:Ye,addInputNumberofCustomersForm:Z,maximizedToggle:F}}});var K=t(28886),G=t(68689),J=t(63314),X=t(64689),ee=t(24554),le=t(83944),te=t(76915),ae=t(2165),ie=t(81052),oe=t(17132),re=t(62025),ne=t(18186),se=t(24600),ue=t(83884),de=t(69721),ce=t(46778),ve=t(10151),me=t(10846),fe=t(5363),pe=t(25589),ge=t(92414),we=t(99367),be=t(60677),he=t(7518),ye=t.n(he);$.render=E;const xe=$;ye()($,"components",{QToggle:K.Z,QForm:G.Z,QSelect:J.Z,QInput:X.Z,QIcon:ee.Z,QPopupProxy:le.Z,QDate:te.Z,QBtn:ae.Z,QFile:ie.Z,QTable:oe.Z,QSpace:re.Z,QTr:ne.Z,QVirtualScroll:se.Z,QTd:ue.Z,QBadge:de.Z,QDialog:ce.Z,QCard:ve.Z,QBar:me.Z,QTooltip:fe.Z,QCardSection:pe.Z,QTh:ge.Z,QCardActions:we.Z}),ye()($,"directives",{ClosePopup:be.Z})}}]);